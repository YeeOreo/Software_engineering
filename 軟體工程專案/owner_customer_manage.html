<!-- 待定 -->
<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>檢視訂單</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">    
	  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> 
    <!-- 採用axios，與ajax效果一樣 -->
   	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>
    <style>
      table, th, td {  
        border: 1px solid black;
      }
    </style>
    <nav class="navbar navbar-default">        
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="visitor_index.html">FBL</a>
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">導覽按鈕</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>          
          </div>
          <!-- <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="dance00.html">首頁</a></li>
              <li class="active"><a href="dance01.html">心得</a></li>
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                圖/影 <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="dance02.html">圖片</a></li>
                  <li><a href="dance03.html">影集</a></li>
                </ul>
              </li>
            </ul>
            
            <form class="navbar-form navbar-right">
              <div class="form-group has-feedback">
                  <input type="search" class="form-control" placeholder="search"><span class="glyphicon-search form-control-feedback"></span>
              </div>
              <button type="submit" class="btn btn-default">搜尋</button>
            </form> 
          </div> -->
          <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li><a href="store_owner_manage.html">Manage Menu</a></li>
                <li class="active"><a href="owner_customer_manage.html">顧客資訊</a></li>
                <li><a href="owner_order.html">檢視訂單</a></li>
              </ul>
                  <ul class = "nav navbar-nav navbar-right">
                  <li class="dropdown">
                  <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                  <span style="padding-right: 10px; color: navy;">Hi! boss_test</span><img src="img/Setting_icon.png" width="30px"> <span class="caret"></span></a>
                  <ul class="dropdown-menu">
                    <!-- <li><a href="Account_Setting.html">Account Setting</a></li> -->
                    <!-- <li><a href="preference.html">My preference Setting</a></li> -->
                    <li><a href="store_owner_sign_in.html">Sign in</a></li>
                    <li><a href="#">Sign out</a></li>
                </ul>
                </li>
              </ul>
              <!-- <form class="navbar-form navbar-right">
                <div class="form-group has-feedback">
                    <input type="search" class="form-control" placeholder="search"><span class="glyphicon-search form-control-feedback"></span>
                </div>
                <button type="submit" class="btn btn-default">搜尋</button>
              </form> -->
            </div>
        </div>
      </nav>
      <!--頁首-->
	<header>
		<div class="container">
			<h1>顧客資訊</h1>
			<p class="lead"></p>
			<hr>
		</div>
	</header>
	<!--內容區-->
  <div class="container">
        <h3>
          顧客資訊管理
        </h3>
        <div class = "row">
          <!-- 第1個搜尋Bar -->
            <div class="col-xs-3">
              <input type="text" id = "nickname" class="form-control" placeholder="Search by nickname" name="search">
            </div>                             
                
          <!-- 第2個搜尋Bar -->
            <div class="col-xs-4">
                <input type="text" id = "phone" class="form-control" placeholder="Search by phone" name="search">
            </div>
              
          <!-- 第3個搜尋Bar -->
          <div class = "col-xs-4">
              <div class="input-group">
                <input type="date" id = "birthday" class="form-control" placeholder="Search by birthday" name="search">
                <div class="input-group-btn">
                  <button id = "search_btn" class="btn btn-primary " type="button"><i class="glyphicon glyphicon-search"></i></button>
                </div>
              </div>
          </div>
        </div>
      <hr>
      <!-- 搜尋結果Table -->
      <div class="row">
        <table id="customer_searching_result">
          
        </table>
    </div>
  </div>
  <script>
    function start(){
      let search_btn = document.getElementById('search_btn');
      search_btn.addEventListener("click", get_customer_list);
    }

    function get_customer_list(){ // 用字串串接
            console.log('搜尋按鈕按下去');
            let nickname = document.getElementById('nickname').value;
            let phone = document.getElementById('phone').value;
            let birthday = document.getElementById('birthday').value;
            let response = ' ';

            if(nickname.length == 0){
              console.log("nickname NULL");
              nickname = ' ';
            }
            if(phone.length == 0){
              console.log("phone NULL");
              phone = ' ';
              console.log('phone：' , phone);
            }
            if(birthday.length == 0){
              console.log("birthday NULL");
              birthday = ' ';
            }
            /*後端空值不好處理，故前端如果沒輸入把字串型態的null給後端*/
            if(nickname == " ")
              nickname = "null";
            if(phone == " ")
              phone = "null";
            if(birthday == " ")
              birthday = "null";
            /*連線作請求及拿回response並處理*/  
            axios
            .get('php/customer_manage.php', {
              params:
              { 
                nickname:nickname,
                phone:phone,
                birthday:birthday
              }
            })
            .then(response => {
                // console.log(res);
                res = response.data;
                res = res.substring(11,res.length);
                // console.table(response);
                renderResult(res);
            })
            .catch(function (error) {
                console.log(error);
            });
        }

        
  function renderResult(res){
          let output = ' ';
          if(res == 'null'){
              output += `<tr>
                            <td colspan="7">查無資料</td>
                          </tr>`;
              //output += `<tr><td colspan="3"></td><td colspan="1">找不到想找的店家嗎?</td><td colspan="2"><a href="addStore.html"><button class="btn btn-success" >點我新增店家</button></a></td></tr>`;
          }
          else{
              for(let i=0;i < res.length ;i++){
                  output += `
                  <tr>
                      <th scope="row">${i+1}</th>
                      <td>${res[i].user_account}</td>
                      <td>${res[i].email}</td>
                      <td>${res[i].nickname}</td>
                      <td>${res[i].phone}</td>
                      <td>${res[i].is_blank}</td>
                      <td>${res[i].preference}</td>
                  </tr>
                  `;
              }
          }
          console.log(output);
          document.getElementById('customer_searching_result').innerHTML = output;
      }
      window.addEventListener('load',start,false);
  </script>
</body>
<html>
